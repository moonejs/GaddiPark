{%extends "base.html" %}

{%block style%}
<link rel="stylesheet" href="{{url_for('static',filename='css/find_parking.css')}}">
{%endblock%}

{%block content %}
<div class="page-1">
    <div>
        <form action="">
            <input type="search" placeholder="Search for a location,landmark or address">
            
            <button>Search</button>
        </form>
    </div>
    
    <h2>Park Lots Near You </h2>
    {%if not lots%}
    <h4>No plots near you </h4>
    {%endif%}
    <div class="content">
        {% for lot in lots %}
        <div class="card">
            {{lot.name}}
            <a href="{{url_for('booking.booking',lot_id=lot.id)}}"><button class="book-spot-btn">Book spot</button></a>
        </div>
    {%endfor%}
    </div>
</div>

<div class="book-spot-model" style="display: none;">
    <div>
        <h2>Confirm Booking </h2>
        <a href="{{url_for('user.find_parking')}}"><button class="close-book-spot-model">Close</button></a>
        
    </div>
    <div>
        <h2>{{lot.name}}</h2>
        <h2>{{lot.address}}</h2>
    </div>
    <form action="{% if lot %}{{ url_for('booking.booking', lot_id=lot.id) }}{% else %}#{% endif %}" method="POST">
        <div>
            <label for="vehicle">Vehicle</label>
            <select name="vehicle" id="vehicle" onchange="handleVehicleChange()" required>
                <option value="">Select a vehicle</option>
                {%for vehicle in vehicles %}
                <option value="{{vehicle.id}}"
                data-is-ev="{{vehicle.is_ev}}" 
                data-model="{{vehicle.model}}"
                data-reg="{{vehicle.registration_number}}">
                {%if vehicle.is_ev %}
                Ev- 
                {%endif%}
                {{vehicle.model}} ({{vehicle.registration_number}})</option>
                {%endfor%}
            </select>
        </div>
        <div>
            <h4>Date:{{current_booking_date}}</h4>
            <h4>Time:{{current_booking_time}}</h4>
        </div>
        <div>
            <label for="duration" >Duration</label>
            <select name="duration" id="duration"onchange="updateRates()" required>
                <option value="1">1 Hour</option>
                <option value="2">2 Hour</option>
                <option value="3">3 Hour</option>
                <option value="4">4 Hour</option>
            </select>
        </div>
        <div id="parking-options" style="display: none;">
            <h4>Parking Types : </h4>
            <div>
                <input type="radio" id="regular" name="parking_type" value="regular" checked onchange="updateRates()">
                <label for="regular">Regular Parking Only</label>
            </div>
            <div>
                <input type="radio" id="ev-charging" name="parking_type" value="ev_charging" onchange="updateRates()">
                <label for="ev-charging">Parking + EV Charging</label>
            </div>
        </div>
        <div id="rate-display">
            <p data-rate="{{lot.hourly_rate}}" id="regular-rate">Parking Rate/Hour : ₹{{lot.hourly_rate}}</p>
            <p id="ev-charging-rate" style="display: none;" data-ev-rate="{{lot.ev_charging_rate}}">
                EV Charging:₹{{lot.ev_charging_rate}}/Kwh
            </p>
        </div>
        <div>
            <label for="estimate_cost">Estimate Cost</label>
            <input type="text" id="estimate_cost" disabled name="estimate_cost" required>
            <input type="hidden" id="hidden_estimate_cost" name="estimate_cost" required>
            
        </div>
        <div>
            <label for="payment_method">Payment Method:</label>
            <select name="payment_method" id="payment_method">
                <option value="{{wallet_balance}}">Wallet (₹{{wallet_balance if wallet_balance is not none else 0}})</option>
                <option value=""></option>
            </select>
        </div>
        <button type="submit" class="confirm-booking-btn">Confirm Booking</button>

    </form>
</div>
    


    {% if lot %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const book_modal = document.querySelector('.book-spot-model');
            const page = document.querySelector('.page-1');

            if (book_modal && page) {
                book_modal.style.display = 'block';
                page.classList.add('blur');
            }
        });
    </script>
{% endif %}


<script src="{{url_for('static',filename='js/find_parking.js')}}"></script>
    

{%endblock%}